<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Murdered.</title>

<!-- GSAP CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

<style>
    body {
        margin: 0;
        background: radial-gradient(circle at center, #111 0%, #050505 100%);
        color: #eaeaea;
        font-family: "Georgia", serif;
        overflow-x: hidden;
        perspective: 1200px;
    }

    section {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 2rem;
    }

    h1 {
        font-size: 4.5rem;
        letter-spacing: 0.15em;
        opacity: 0;
        animation: fadeInTitle 4s ease forwards;
    }

    @keyframes fadeInTitle {
        to { opacity: 1; }
    }

    p {
        max-width: 750px;
        font-size: 1.25rem;
        line-height: 1.8;
        opacity: 0;
        transition: opacity 3s ease;
    }

    .visible {
        opacity: 1;
    }

    .question {
        color: #aa0000;
        font-size: 2.1rem;
        margin-top: 2rem;
        font-weight: bold;
        opacity: 0;
    }

    .glitch {
        animation: flicker 0.15s infinite alternate,
                   glitchShift 0.2s infinite alternate;
    }

    @keyframes flicker {
        from { opacity: 0.5; }
        to { opacity: 1; }
    }

    @keyframes glitchShift {
        0% { text-shadow: 2px 0 red, -2px 0 black; }
        50% { text-shadow: -2px 0 red, 2px 0 black; }
        100% { text-shadow: 2px 0 red, -2px 0 black; }
    }

    .knife-wrapper {
        margin-top: 6rem;
        opacity: 0;
        transform-style: preserve-3d;
    }

    .knife {
        width: 100px;
        filter: drop-shadow(0 0 12px rgba(255,255,255,0.1));
    }

</style>
</head>
<body>

<section>
    <h1>Murdered.</h1>
</section>

<section>
    <div>
        <p id="story">
            I was sitting alone, tiny lamp illuminating the desk in front of me.
            A text from my phone lights up my features,
            I read it and ponder upon the words written upon the screen.
        </p>

        <p class="question" id="question">
            If you were to be murdered, how would you like to go?
        </p>

        <div class="knife-wrapper" id="knifeWrapper">
            <svg class="knife" viewBox="0 0 100 300">
                <path d="M50 10 L65 200 L35 200 Z"
                      fill="silver" stroke="#ccc" stroke-width="2"/>
                <rect x="40" y="200" width="20" height="80"
                      fill="#222"/>
            </svg>
        </div>
    </div>
</section>

<script>
    const story = document.getElementById("story");
    const question = document.getElementById("question");
    const knifeWrapper = document.getElementById("knifeWrapper");

    // Scroll reveal for story
    const observer = new IntersectionObserver(entries => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {

                story.classList.add("visible");

                // 3 seconds after story → show red question
                setTimeout(() => {
                    question.style.opacity = "1";
                    question.classList.add("glitch");
                    startHeartbeat();

                    // 5 seconds after question → show knife
                    setTimeout(() => {
                        revealKnife();
                    }, 5000);

                }, 3000);

                observer.disconnect();
            }
        });
    }, { threshold: 0.6 });

    observer.observe(story);

    function revealKnife() {
        knifeWrapper.style.opacity = "1";
        playMetalScrape();

        // GSAP 360° 3D rotation
        gsap.fromTo(knifeWrapper,
            { rotationY: 90, scale: 0.8 },
            {
                rotationY: 450, // full 360 from forward-facing
                scale: 1,
                duration: 4,
                ease: "power2.inOut"
            }
        );

        // Fade out after 5 seconds
        setTimeout(() => {
            gsap.to(knifeWrapper, {
                opacity: 0,
                duration: 3,
                ease: "power2.out"
            });
        }, 5000);
    }

    // Heartbeat
    let heartbeatStarted = false;

    function startHeartbeat() {
        if (heartbeatStarted) return;
        heartbeatStarted = true;

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function beat() {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();

            osc.type = "sine";
            osc.frequency.setValueAtTime(80, audioCtx.currentTime);

            gain.gain.setValueAtTime(1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.15);

            osc.connect(gain);
            gain.connect(audioCtx.destination);

            osc.start();
            osc.stop(audioCtx.currentTime + 0.15);
        }

        setInterval(() => {
            beat();
            setTimeout(beat, 250);
        }, 1200);
    }

    // Metallic scrape
    function playMetalScrape() {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate * 1.5, audioCtx.sampleRate);
        const data = buffer.getChannelData(0);

        for (let i = 0; i < data.length; i++) {
            data[i] = (Math.random() * 2 - 1) * 0.3;
        }

        const noise = audioCtx.createBufferSource();
        noise.buffer = buffer;

        const filter = audioCtx.createBiquadFilter();
        filter.type = "bandpass";
        filter.frequency.value = 1200;
        filter.Q.value = 1;

        const gain = audioCtx.createGain();
        gain.gain.setValueAtTime(0.4, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.2);

        noise.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);

        noise.start();
        noise.stop(audioCtx.currentTime + 1.2);
    }

</script>

</body>
</html>

